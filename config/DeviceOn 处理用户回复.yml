app:
  description: ''
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: DeviceOn å¤„ç†ç”¨æˆ·å›å¤
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/ollama:0.0.3@9ded90ac00e8510119a24be7396ba77191c9610d5e1e29f59d68fa1229822fc7
kind: app
version: 0.1.5
workflow:
  conversation_variables: []
  environment_variables:
  - description: ''
    id: 49dec224-315f-4cf7-884f-26b5cc538994
    name: add_task
    selector:
    - env
    - add_task
    value: app-qw3E0MI5rY47UbIvqhiM7FCu
    value_type: string
  - description: ''
    id: 66571786-6db5-4643-95e1-a6a628f6b26a
    name: path
    selector:
    - env
    - path
    value: http://172.21.161.126/v1/workflows/run
    value_type: string
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1743649547982-source-1743649657177-target
      source: '1743649547982'
      sourceHandle: source
      target: '1743649657177'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1743649657177-source-1743649783399-target
      source: '1743649657177'
      sourceHandle: source
      target: '1743649783399'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: code
      id: 17436599536740-source-17436599619100-target
      source: '17436599536740'
      sourceHandle: source
      target: '17436599619100'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: end
      id: 17436599619100-source-17436599645130-target
      source: '17436599619100'
      sourceHandle: source
      target: '17436599645130'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: code
      id: 1743646903355-source-1744178241091-target
      source: '1743646903355'
      sourceHandle: source
      target: '1744178241091'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1744178241091-source-1744178342442-target
      source: '1744178241091'
      sourceHandle: source
      target: '1744178342442'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1744178342442-true-1743649547982-target
      source: '1744178342442'
      sourceHandle: 'true'
      target: '1743649547982'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: end
      id: 1744178342442-false-1744178528807-target
      source: '1744178342442'
      sourceHandle: 'false'
      target: '1744178528807'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: http-request
      id: 1744178342442-1f317717-e0eb-4fb4-9222-294e27f2784e-17436599536740-target
      source: '1744178342442'
      sourceHandle: 1f317717-e0eb-4fb4-9222-294e27f2784e
      target: '17436599536740'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: http-request
      id: 1744178342442-4d93e724-5c30-4c20-bc63-2540132c09bc-1744355038209-target
      source: '1744178342442'
      sourceHandle: 4d93e724-5c30-4c20-bc63-2540132c09bc
      target: '1744355038209'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: end
      id: 1743649783399-false-1743649813355-target
      source: '1743649783399'
      sourceHandle: 'false'
      target: '1743649813355'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: http-request
      id: 1743649783399-true-17436599536740-target
      source: '1743649783399'
      sourceHandle: 'true'
      target: '17436599536740'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: http-request
      id: 1743649783399-05dffa90-879f-4567-bed2-9872eb011bdd-1744355038209-target
      source: '1743649783399'
      sourceHandle: 05dffa90-879f-4567-bed2-9872eb011bdd
      target: '1744355038209'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: http-request
        targetType: code
      id: 1744355038209-source-1744357335540-target
      source: '1744355038209'
      sourceHandle: source
      target: '1744357335540'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: end
      id: 1744357335540-source-1744357721350-target
      source: '1744357335540'
      sourceHandle: source
      target: '1744357721350'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: http-request
      id: 1744178342442-20e34104-d58b-4af7-ac76-b6abee3064c2-1744362095970-target
      source: '1744178342442'
      sourceHandle: 20e34104-d58b-4af7-ac76-b6abee3064c2
      target: '1744362095970'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: http-request
        targetType: code
      id: 1744362095970-source-1744362369879-target
      source: '1744362095970'
      sourceHandle: source
      target: '1744362369879'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: end
      id: 1744362369879-source-1744362479983-target
      source: '1744362369879'
      sourceHandle: source
      target: '1744362479983'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: http-request
      id: 1743649783399-2ad02a69-30ad-4584-b661-196f65e815d0-1744362095970-target
      source: '1743649783399'
      sourceHandle: 2ad02a69-30ad-4584-b661-196f65e815d0
      target: '1744362095970'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: api
          max_length: 256
          options: []
          required: true
          type: text-input
          variable: api
        - label: token
          max_length: 256
          options: []
          required: true
          type: text-input
          variable: token
        - label: timezone
          max_length: 256
          options: []
          required: true
          type: text-input
          variable: timezone
        - label: question
          max_length: 80000
          options: []
          required: true
          type: paragraph
          variable: question
        - label: content
          max_length: 80000
          options: []
          required: true
          type: paragraph
          variable: content
        - label: type
          max_length: 80000
          options: []
          required: true
          type: paragraph
          variable: type
      height: 220
      id: '1743646903355'
      position:
        x: 30
        y: 335
      positionAbsolute:
        x: 30
        y: 335
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: true
          variable_selector:
          - '1743646903355'
          - question
        desc: ''
        model:
          completion_params:
            num_ctx: 32768
            temperature: 0
          mode: chat
          name: deepseek-r1:14b
          provider: langgenius/ollama/ollama
        prompt_template:
        - id: 391e7b29-584f-483d-a4e9-4d0a6a7f6cb2
          role: system
          text: "# æ–‡æœ¬ç¡®è®¤åˆ¤æ–­æç¤ºè¯\n\n**ä»»åŠ¡**  \nåˆ¤æ–­è¾“å…¥æ–‡æœ¬æ˜¯å¦ä¸ºç¡®è®¤/è‚¯å®šæ€§è¡¨è¿°ï¼Œè¿”å›JSONæ ¼å¼ç»“æœã€‚\n\n**è¾“å…¥æ–‡æœ¬**\
            \  \n{{#context#}}\n\n**åˆ¤æ–­æ ‡å‡†**  \n1. åŒ…å«æ˜ç¡®åŒæ„/ç¡®è®¤è¯æ±‡ï¼ˆå¦‚ï¼šå¥½ã€å¥½çš„ã€ç¡®å®šã€å¯ä»¥ã€æ²¡é—®é¢˜ã€æ˜¯çš„ã€OKã€Goï¼‰\
            \  \n2. è¡¨è¾¾æ­£å‘å®Œæˆæ€ï¼ˆå¦‚ï¼šå·²å¤„ç†ã€å·²å®Œæˆï¼‰  \n3. ç§¯æå›åº”è¯·æ±‚ï¼ˆå¦‚ï¼šé©¬ä¸ŠåŠã€è¿™å°±åšï¼‰  \n4. æ’é™¤å¦å®š/æ¨¡ç³Šè¡¨è¿°ï¼ˆå¦‚ï¼šä¸è¡Œã€å¯èƒ½å§ã€å†è¯´ï¼‰\n\
            \n**å¤„ç†æµç¨‹**\n1. æ–‡æœ¬è§£æï¼šæå–æ ¸å¿ƒåŠ¨è¯/è¡¨æ€è¯\n2. è¯­ä¹‰åŒ¹é…ï¼šå¯¹ç…§ç¡®è®¤è¡¨è¾¾è¯åº“\n3. è¯­å¢ƒåˆ†æï¼šè¯†åˆ«åº”ç­”å¯¹è±¡å®Œæ•´æ€§\n\
            4. åŒé‡éªŒè¯ï¼šäº¤å‰æ£€æŸ¥å¦å®šè¯å­˜åœ¨æ€§\n\n**è¾“å‡ºè¦æ±‚**  \n```json\n{\n  \"judgment\": \"<boolean>\"\
            ,\n  \"reason\": \"<ä¸è¶…è¿‡15å­—çš„å…³é”®è¯ä¾æ®>\"\n}\n```\n"
        selected: false
        title: LLM åˆ¤æ–­æ˜¯å¦ç¡®è®¤
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1743649547982'
      position:
        x: 942
        y: 335
      positionAbsolute:
        x: 942
        y: 335
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "function handleLLM(text) {\n  const regex = /```json([\\s\\S]*?)```/\n\
          \  const _res = text.replaceAll(/<think>[\\s\\S]*?<\\/think>/g, '')\n  const\
          \ match = _res.match(regex);\n  const res = !!match ? match[1].trim() :\
          \ _res\n  const str = res.replaceAll(/\\/\\/.*$/gm, '').replaceAll(/\\/\\\
          *[\\s\\S]*?\\*\\//g, '')\n  let obj\n  try {\n    obj = JSON.parse(str)\n\
          \  } catch (e) {\n    obj = {}\n  }\n  return obj\n}\nfunction main({text,\
          \ type, result}) {\n  const obj = handleLLM(text)\n  const judgment = !!obj?.['judgment']\
          \ && obj?.['judgment'] !== 'false'\n  let action = '', answer = 1\n  if\
          \ (!judgment) answer = 0\n  if (judgment) {\n    switch (type) {\n     \
          \ case 'control_task':\n        action = 'task'\n        break\n      case\
          \ 'ota_task':\n        const obj = JSON.parse(result)\n        if (obj?.step\
          \ === 'select_device') {\n          action = 'device'\n        }\n     \
          \   if (obj?.step === 'confirm_flow') {\n          action = 'target'\n \
          \       }\n        break\n    }\n  }\n  return {\n    answer,\n    action,\n\
          \  }\n}"
        code_language: javascript
        desc: ''
        outputs:
          action:
            children: null
            type: string
          answer:
            children: null
            type: number
        selected: false
        title: å¤„ç†ç¡®è®¤åˆ¤æ–­
        type: code
        variables:
        - value_selector:
          - '1743649547982'
          - text
          variable: text
        - value_selector:
          - '1743646903355'
          - type
          variable: type
        - value_selector:
          - '1744178241091'
          - result
          variable: result
      height: 54
      id: '1743649657177'
      position:
        x: 1246
        y: 335
      positionAbsolute:
        x: 1246
        y: 335
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: contains
            id: 61466132-23b7-4481-9d02-20caef772ee4
            value: task
            varType: string
            variable_selector:
            - '1743649657177'
            - action
          id: 'true'
          logical_operator: and
        - case_id: 05dffa90-879f-4567-bed2-9872eb011bdd
          conditions:
          - comparison_operator: contains
            id: fc5edcfc-13f8-48e5-926f-5907f8e773dc
            value: device
            varType: string
            variable_selector:
            - '1743649657177'
            - action
          id: 05dffa90-879f-4567-bed2-9872eb011bdd
          logical_operator: and
        - case_id: 2ad02a69-30ad-4584-b661-196f65e815d0
          conditions:
          - comparison_operator: is
            id: e215af3f-55c2-4472-b154-59eb8793203f
            value: target
            varType: string
            variable_selector:
            - '1743649657177'
            - action
          logical_operator: and
        desc: ''
        selected: false
        title: åˆ¤æ–­ç¡®è®¤å action
        type: if-else
      height: 222
      id: '1743649783399'
      position:
        x: 1550
        y: 335
      positionAbsolute:
        x: 1550
        y: 335
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1743649657177'
          - answer
          variable: answer
        - value_selector:
          - '1744178241091'
          - result
          variable: result
        - value_selector:
          - '1744178241091'
          - content
          variable: content
        - value_selector:
          - '1744178241091'
          - type
          variable: type
        selected: false
        title: è¿”å›æ•°æ®
        type: end
      height: 168
      id: '1743649813355'
      position:
        x: 1854
        y: 335
      positionAbsolute:
        x: 1854
        y: 335
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data:
          - id: key-value-45
            key: ''
            type: text
            value: '{{#1744178241091.request#}}'
          type: json
        desc: ''
        headers: 'Authorization:Bearer {{#env.add_task#}}

          Content-Type:application/json'
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: æ–°å¢ä»»åŠ¡
        type: http-request
        url: '{{#env.path#}}'
        variables: []
      height: 123
      id: '17436599536740'
      position:
        x: 1854
        y: 543
      positionAbsolute:
        x: 1854
        y: 543
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "/**\n * å¤„ç†æ–°å¢ä»»åŠ¡\n */\nfunction main({body}) {\n  const obj = JSON.parse(body)\n\
          \  const outputs = obj?.data?.outputs ?? {}\n  return {\n    result: outputs?.result\
          \ ?? '',\n    content: outputs?.content ?? '',\n    type: outputs?.type\
          \ ?? '',\n  }\n}\n\n"
        code_language: javascript
        desc: ''
        outputs:
          content:
            children: null
            type: string
          result:
            children: null
            type: string
          type:
            children: null
            type: string
        selected: false
        title: å¤„ç†æ–°å¢ä»»åŠ¡
        type: code
        variables:
        - value_selector:
          - '17436599536740'
          - body
          variable: body
      height: 54
      id: '17436599619100'
      position:
        x: 2158
        y: 520.5
      positionAbsolute:
        x: 2158
        y: 520.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1744178241091'
          - answer
          variable: answer
        - value_selector:
          - '17436599619100'
          - result
          variable: result
        - value_selector:
          - '17436599619100'
          - content
          variable: content
        - value_selector:
          - '17436599619100'
          - type
          variable: type
        selected: false
        title: è¿”å›æ•°æ®
        type: end
      height: 168
      id: '17436599645130'
      position:
        x: 2462
        y: 520.5
      positionAbsolute:
        x: 2462
        y: 520.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "function main({question, content, type, api, token, timezone}) {\n\
          \  let request = '', action = '', osType = '', target_url = ''\n  let cache_content\
          \ = '', cache_type = '', answer = 0, result = ''\n  switch (type) {\n  \
          \  case 'control_task':\n      request = JSON.stringify({\n        inputs:\
          \ {\n          content,\n          timezone,\n          api,\n         \
          \ token\n        },\n        response_mode: 'blocking',\n        user: 'deviceOn\
          \ reply'\n      })\n      action = 'confirm'\n      answer = 1\n      break\n\
          \    case 'find_device':\n    case 'find_error':\n      const query = String(question)\n\
          \      if (query.endsWith(' REMOTE_DESKTOP') || query.endsWith(' REBOOT'))\
          \ {\n        const obj = JSON.parse(content)\n        const device = Array.isArray(obj?.data?.targetDevices)\
          \ ? Array.from(obj?.data?.targetDevices) : []\n        const filter = device.filter(o\
          \ => {\n          return query.includes(o?.id) || query.includes(o?.name)\
          \ || query.includes(o?.ip)\n        })\n        result = JSON.stringify({\n\
          \          type: 'find_device',\n          data: {\n            ...obj.data,\n\
          \            assign_device: true,\n            targetDevices: filter,\n\
          \          }\n        })\n        if (filter.length === 1) {\n         \
          \ if (query.endsWith(' REMOTE_DESKTOP')) {\n            result = JSON.stringify({\n\
          \              type: 'remote_desktop',\n              data: {\n        \
          \        ...obj.data,\n                targetDevices: filter,\n        \
          \      }\n            })\n          }\n          if (query.endsWith(' REBOOT'))\
          \ {\n            result = JSON.stringify({\n              type: 'control_task',\n\
          \              data: {\n                ...obj.data,\n                targetDevices:\
          \ filter,\n                actionCode: '90001',\n                schedule:\
          \ {\n                  scheduleType: 'NONE',\n                }\n      \
          \        }\n            })\n            request = JSON.stringify({\n   \
          \           inputs: {\n                content: result,\n              \
          \  timezone,\n                api,\n                token\n            \
          \  },\n              response_mode: 'blocking',\n              user: 'deviceOn\
          \ reply'\n            })\n            action = 'task'\n          }\n   \
          \     }\n        if (filter.length > 1) {\n          cache_content = result\n\
          \          cache_type = 'find_device'\n        }\n        answer = 1\n \
          \       break\n      }\n      cache_content = content\n      cache_type\
          \ = type\n      break\n    case 'remote_desktop':\n      if (type === 'remote_desktop')\
          \ {\n        const obj = JSON.parse(content)\n        const query = String(question)\n\
          \        const device = Array.isArray(obj?.data?.targetDevices) ? Array.from(obj?.data?.targetDevices)\
          \ : []\n        const filter = device.filter(o => {\n          return query.includes(o?.id)\
          \ || query.includes(o?.name) || query.includes(o?.ip)\n        })\n    \
          \    result = JSON.stringify({\n          type: 'remote_desktop',\n    \
          \      data: {\n            ...obj.data,\n            targetDevices: filter,\n\
          \          }\n        })\n        if (filter.length > 1) {\n          cache_content\
          \ = result\n          cache_type = 'remote_desktop'\n        }\n       \
          \ answer = 1\n      }\n      break\n    case 'ota_task':\n      if (type\
          \ === 'ota_task') {\n        answer = 1\n        const obj = JSON.parse(content)\n\
          \        const query = String(question)\n        const target = Array.isArray(obj?.data?.target)\
          \ ? Array.from(obj.data.target) : []\n        osType = obj?.data?.osType\
          \ ?? ''\n        const actionCode = String(obj?.data?.actionCode)\n    \
          \    const filter = target.filter(o => {\n          return query.includes(o?.name)\n\
          \        })\n        if (!osType) {\n          const oses = filter.map(o\
          \ => o?.os)\n          if (oses.length === 1) osType = oses[0]\n       \
          \ }\n        const device = Array.isArray(obj?.data?.targetDevices) ? Array.from(obj.data.targetDevices)\
          \ : []\n        let filter_device = device.filter(o => osType === o?.os)\n\
          \        const fail_device = device.filter(o => osType !== o?.os).map(o\
          \ => o?.name)\n        if (obj?.step === 'select_target') {\n          result\
          \ = JSON.stringify({\n            ...obj,\n            step: filter.length\
          \ > 0 ? 'select_target' : 'no_target',\n            data: {\n          \
          \    ...obj.data,\n              target: filter,\n              target_len:\
          \ filter.length,\n              osType,\n              fail: [],\n     \
          \       }\n          })\n          if (filter.length === 0) {\n        \
          \    break\n          }\n          // éœ€è¦é‡æ–°é€‰æ‹©\n          if (!osType || (filter.length\
          \ > 1 && ['90071', '90081'].includes(actionCode))) {\n            cache_content\
          \ = result\n            cache_type = type\n            break\n         \
          \ }\n          result = JSON.stringify({\n            ...obj,\n        \
          \    step: filter_device.length > 0 ? 'confirm_device' : 'select_device',\n\
          \            data: {\n              ...obj.data,\n              target:\
          \ filter,\n              osType,\n              target_len: filter.length,\n\
          \              fail: fail_device,\n              device_len: device.length,\n\
          \              targetDevices: filter_device\n            }\n          })\n\
          \          if (filter_device.length > 0) {\n            cache_content =\
          \ result\n            cache_type = type\n            break\n          }\n\
          \          action = 'device'\n          break\n        }\n        if (obj?.step\
          \ === 'confirm_target') {\n          result = JSON.stringify({\n       \
          \     ...obj,\n            step: filter_device.length > 0 ? 'confirm_device'\
          \ : 'select_device',\n            data: {\n              ...obj.data,\n\
          \              target: filter.length > 0 ? filter : target,\n          \
          \    target_len: filter.length > 0 ? filter.length : target.length,\n  \
          \            fail: fail_device,\n              device_len: device.length,\n\
          \              targetDevices: filter_device,\n            }\n          })\n\
          \          if (filter.length > 0) {\n            if (filter_device.length\
          \ > 0) {\n              cache_content = result\n              cache_type\
          \ = type\n              break\n            }\n            action = 'device'\n\
          \            break\n          }\n          action = 'confirm'\n        \
          \  break\n        }\n        filter_device = device.filter(o => {\n    \
          \      return query.includes(o?.name) || query.includes(o?.id) || query.includes(o?.os)\n\
          \        })\n        switch (actionCode) {\n          case '90021':\n  \
          \        case '90022':\n            target_url = '/walle/ai/taskAssist/listSoftware'\n\
          \            break\n          case '90071':\n            target_url = '/walle/ai/taskAssist/listScript'\n\
          \            break\n          case '90081':\n            target_url = '/walle/ai/taskAssist/listFile'\n\
          \            break\n        }\n        if (obj?.step === 'select_device')\
          \ {\n          result = JSON.stringify({\n            ...obj,\n        \
          \    step: filter_device.length > 0 ? 'confirm_flow' : 'no_device',\n  \
          \          data: {\n              ...obj.data,\n              targetDevices:\
          \ filter_device,\n              device_len: filter_device.length,\n    \
          \        }\n          })\n          if (filter_device.length === 0) {\n\
          \            break\n          }\n          action = 'target'\n         \
          \ break\n        }\n        if (obj?.step === 'confirm_device') {\n    \
          \      result = JSON.stringify({\n            ...obj,\n            step:\
          \ 'confirm_flow',\n            data: {\n              ...obj.data,\n   \
          \           targetDevices: filter_device.length > 0 ? filter_device : device,\n\
          \              device_len: filter_device.length > 0 ? filter_device.length\
          \ : device.length,\n            }\n          })\n          if (filter_device.length\
          \ > 0) {\n            action = 'target'\n            break\n          }\n\
          \          action = 'confirm'\n          break\n        }\n      }\n   \
          \   break\n    default:\n      break\n  }\n  return {\n    action,\n   \
          \ answer,\n    content: cache_content,\n    request,\n    result,\n    type:\
          \ cache_type,\n    osType,\n    target_url,\n  }\n}"
        code_language: javascript
        desc: ''
        outputs:
          action:
            children: null
            type: string
          answer:
            children: null
            type: number
          content:
            children: null
            type: string
          osType:
            children: null
            type: string
          request:
            children: null
            type: string
          result:
            children: null
            type: string
          target_url:
            children: null
            type: string
          type:
            children: null
            type: string
        selected: false
        title: å¤„ç†ç”¨æˆ·å›å¤
        type: code
        variables:
        - value_selector:
          - '1743646903355'
          - question
          variable: question
        - value_selector:
          - '1743646903355'
          - content
          variable: content
        - value_selector:
          - '1743646903355'
          - type
          variable: type
        - value_selector:
          - '1743646903355'
          - api
          variable: api
        - value_selector:
          - '1743646903355'
          - token
          variable: token
        - value_selector:
          - '1743646903355'
          - timezone
          variable: timezone
      height: 54
      id: '1744178241091'
      position:
        x: 334
        y: 335
      positionAbsolute:
        x: 334
        y: 335
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 34ddb985-5078-4bed-b306-7b35f8129ab4
            value: confirm
            varType: string
            variable_selector:
            - '1744178241091'
            - action
          id: 'true'
          logical_operator: and
        - case_id: 1f317717-e0eb-4fb4-9222-294e27f2784e
          conditions:
          - comparison_operator: is
            id: c969ffbc-fa34-4d49-893c-b9a5f2f9de5f
            value: task
            varType: string
            variable_selector:
            - '1744178241091'
            - action
          id: 1f317717-e0eb-4fb4-9222-294e27f2784e
          logical_operator: and
        - case_id: 4d93e724-5c30-4c20-bc63-2540132c09bc
          conditions:
          - comparison_operator: is
            id: 87712489-a21b-4f8d-b790-ba37c63b3705
            value: device
            varType: string
            variable_selector:
            - '1744178241091'
            - action
          id: 4d93e724-5c30-4c20-bc63-2540132c09bc
          logical_operator: and
        - case_id: 20e34104-d58b-4af7-ac76-b6abee3064c2
          conditions:
          - comparison_operator: is
            id: 8df8a024-fc9a-42e3-b3b7-c7e2df723dea
            value: target
            varType: string
            variable_selector:
            - '1744178241091'
            - action
          logical_operator: and
        desc: ''
        selected: false
        title: åˆ¤æ–­ action
        type: if-else
      height: 270
      id: '1744178342442'
      position:
        x: 638
        y: 335
      positionAbsolute:
        x: 638
        y: 335
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1744178241091'
          - answer
          variable: answer
        - value_selector:
          - '1744178241091'
          - result
          variable: result
        - value_selector:
          - '1744178241091'
          - content
          variable: content
        - value_selector:
          - '1744178241091'
          - type
          variable: type
        selected: false
        title: è¿”å›æ•°æ®
        type: end
      height: 168
      id: '1744178528807'
      position:
        x: 942
        y: 803.5
      positionAbsolute:
        x: 942
        y: 803.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data: []
          type: none
        desc: ''
        headers: Authorization:{{#1743646903355.token#}}
        method: get
        params: deviceOs:{{#1744178241091.osType#}}
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: è®¾å¤‡åˆ—è¡¨
        type: http-request
        url: '{{#1743646903355.api#}}/walle/ai/device/list'
        variables: []
      height: 139
      id: '1744355038209'
      position:
        x: 1854
        y: 743
      positionAbsolute:
        x: 1854
        y: 743
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "function main({body, result}) {\n  const res = JSON.parse(body)\n \
          \ const obj = JSON.parse(result)\n  const device = Array.isArray(res?.rows)\
          \ ? Array.from(res.rows) : []\n  const filter = device.map(o => {\n    return\
          \ {\n      id: o.deviceId,\n      name: o.deviceName,\n      os: o.deviceOs,\n\
          \      timezone: o.timezone,\n    }\n  })\n  const content = JSON.stringify({\n\
          \    ...obj,\n    data: {\n      ...obj.data,\n      targetDevices: filter,\n\
          \    }\n  })\n  return {\n    result: content,\n    content,\n  }\n}"
        code_language: javascript
        desc: ''
        outputs:
          content:
            children: null
            type: string
          result:
            children: null
            type: string
        selected: false
        title: å¤„ç†è®¾å¤‡
        type: code
        variables:
        - value_selector:
          - '1744355038209'
          - body
          variable: body
        - value_selector:
          - '1744178241091'
          - result
          variable: result
      height: 54
      id: '1744357335540'
      position:
        x: 2158
        y: 728.5
      positionAbsolute:
        x: 2158
        y: 728.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1744178241091'
          - answer
          variable: answer
        - value_selector:
          - '1744357335540'
          - result
          variable: result
        - value_selector:
          - '1744357335540'
          - content
          variable: content
        - value_selector:
          - '1743646903355'
          - type
          variable: type
        selected: false
        title: è¿”å›æ•°æ®
        type: end
      height: 168
      id: '1744357721350'
      position:
        x: 2462
        y: 728.5
      positionAbsolute:
        x: 2462
        y: 728.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data: []
          type: none
        desc: ''
        headers: Authorization:{{#1743646903355.token#}}
        method: get
        params: osType:{{#1744178241091.osType#}}
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: è½¯ä»¶/è„šæœ¬/æ¡£æ¡ˆåˆ—è¡¨
        type: http-request
        url: '{{#1743646903355.api#}}{{#1744178241091.target_url#}}'
        variables: []
      height: 142
      id: '1744362095970'
      position:
        x: 1854
        y: 949.5
      positionAbsolute:
        x: 1854
        y: 949.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "/**\n * å°†å­—èŠ‚æ•°è½¬æ¢ä¸ºå¸¦å•ä½çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ 2048 -> \"2KB\"\n * @param {number} bytes\
          \ - æ–‡ä»¶å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰\n * @return {string} - æ ¼å¼åŒ–åçš„æ–‡ä»¶å¤§å°å­—ç¬¦ä¸²\n */\nfunction formatFileSize(bytes)\
          \ {\n  if (bytes < 0) {\n    throw new Error(\"æ–‡ä»¶å¤§å°ä¸èƒ½ä¸ºè´Ÿæ•°\");\n  }\n  if\
          \ (bytes === 0) return \"0B\";\n\n  // å®šä¹‰å•ä½æ•°ç»„\n  const units = [\"B\", \"\
          KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n  // è®¡ç®—æ–‡ä»¶å¤§å°å¯¹åº”çš„å•ä½ç´¢å¼•ï¼ˆå‘ä¸‹å–æ•´ï¼‰ï¼Œä»¥ 1024\
          \ ä¸ºè¿›åˆ¶\n  const index = Math.floor(Math.log(bytes) / Math.log(1024));\n \
          \ // æ ¹æ®å•ä½è®¡ç®—è½¬æ¢åçš„å¤§å°\n  let size = bytes / Math.pow(1024, index);\n  // å¦‚æœç»“æœæ˜¯æ•´æ•°å°±ä¸æ˜¾ç¤ºå°æ•°ï¼Œå¦åˆ™ä¿ç•™ä¸¤ä½å°æ•°\n\
          \  size = size % 1 === 0 ? size : size.toFixed(2);\n\n  return size + units[index];\n\
          }\nfunction main({body, result}) {\n  const res = JSON.parse(body)\n  const\
          \ obj = JSON.parse(result)\n  const list = Array.isArray(res?.rows) ? Array.from(res.rows)\
          \ : []\n  const tenant = Array.isArray(res?.data?.tenantSoftwareList) ?\
          \ Array.from(res.data.tenantSoftwareList) : []\n  const system = Array.isArray(res?.data?.systemSoftwareList)\
          \ ? Array.from(res.data.systemSoftwareList) : []\n  const list_id = {},\
          \ tenant_id = {}, system_id = {}\n  list.forEach(o => list_id[o?.frId ??\
          \ o?.srId] = o)\n  tenant.forEach(o => tenant_id[o?.repoId] = o)\n  system.forEach(o\
          \ => system_id[o?.repoId] = o)\n  const actionCode = String(obj?.data?.actionCode)\n\
          \  const target = Array.isArray(obj?.data?.target) ? Array.from(obj.data.target)\
          \ : []\n  const device = Array.isArray(obj?.data?.targetDevices) ? Array.from(obj.data.targetDevices)\
          \ : []\n  const osType = String(obj?.data?.osType)\n  let parameter = {},\
          \ flow = 0\n  switch (actionCode) {\n    case '90021':\n      const installSoftwareList\
          \ = target.map(v => {\n        let use = false\n        if (!!tenant[v?.id])\
          \ use = true\n        const o = (tenant[v?.id] ?? system[v?.id]) ?? {}\n\
          \        const pkg = o?.pkgList?.[0] ?? {}\n        if (use) flow += Number(pkg?.fileSize\
          \ ?? 0)\n        return {\n          ...pkg\n        }\n      })\n     \
          \ parameter = {\n        osType,\n        installSoftwareList,\n      }\n\
          \      break\n    case '90022':\n      const uninstallSoftwareList = target.map(v\
          \ => {\n        let use = false\n        if (!!tenant[v?.id]) use = true\n\
          \        const o = (tenant[v?.id] ?? system[v?.id]) ?? {}\n        const\
          \ pkg = o?.pkgList?.[0] ?? {}\n        if (use) flow += Number(pkg?.fileSize\
          \ ?? 0)\n        return {\n          ...pkg\n        }\n      })\n     \
          \ parameter = {\n        osType,\n        uninstallSoftwareList,\n     \
          \ }\n      break\n    case '90071':\n      const script = target?.[0]?.scriptPkgList?.[0]\
          \ ?? {}\n      flow += Number(script?.fileSize ?? 0)\n      parameter =\
          \ {\n        ...script,\n        osType,\n      }\n      break\n    case\
          \ '90081':\n      const fc = target?.[0]\n      Array.isArray(fc?.filePkgList)\
          \ && Array.from(fc.filePkgList).forEach(o => {\n        flow += Number(o?.fileSize\
          \ ?? 0)\n      })\n      parameter = {\n        ...fc,\n        osType,\n\
          \      }\n      break\n  }\n  flow = flow * device.length\n  const content\
          \ = JSON.stringify({\n    ...obj,\n    data: {\n      ...obj.data,\n   \
          \   parameter,\n      flow: formatFileSize(flow),\n    }\n  })\n  return\
          \ {\n    result: content,\n    content,\n  }\n}"
        code_language: javascript
        desc: ''
        outputs:
          content:
            children: null
            type: string
          result:
            children: null
            type: string
        selected: false
        title: å¤„ç†è½¯ä»¶/è„šæœ¬/æ¡£æ¡ˆ
        type: code
        variables:
        - value_selector:
          - '1744362095970'
          - body
          variable: body
        - value_selector:
          - '1744178241091'
          - result
          variable: result
      height: 54
      id: '1744362369879'
      position:
        x: 2158
        y: 936.5
      positionAbsolute:
        x: 2158
        y: 936.5
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1744178241091'
          - answer
          variable: answer
        - value_selector:
          - '1744362369879'
          - result
          variable: result
        - value_selector:
          - '1744362369879'
          - content
          variable: content
        - value_selector:
          - '1743646903355'
          - type
          variable: type
        selected: false
        title: è¿”å›æ•°æ®
        type: end
      height: 168
      id: '1744362479983'
      position:
        x: 2462
        y: 936.5
      positionAbsolute:
        x: 2462
        y: 936.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: -309.9999999999998
      y: -82.00000000000006
      zoom: 0.7
